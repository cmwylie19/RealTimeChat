{"version":3,"sources":["../../../../src/components/withOuia/withOuia.tsx"],"names":["OuiaContext","React","createContext","withOuiaContext","WrappedComponent","props","value","ComponentWithOuia","state","isOuia","ouiaId","consumerContext","isOuiaEnv","undefined","setState","component","componentProps","Component"],"mappings":";;;;;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGO,IAAMA,WAAW,GAAGC,KAAK,CAACC,aAAN,CAA6C,IAA7C,CAApB;;;AAYA,SAASC,eAAT,CACLC,gBADK,EAEuB;AAC5B,SAAO,UAACC,KAAD;AAAA,WACL,oBAAC,WAAD,CAAa,QAAb,QACG,UAACC,KAAD;AAAA,aAA6B,oBAAC,iBAAD;AAAmB,QAAA,eAAe,EAAEA,KAApC;AAA2C,QAAA,SAAS,EAAEF,gBAAtD;AAAwE,QAAA,cAAc,EAAEC;AAAxF,QAA7B;AAAA,KADH,CADK;AAAA,GAAP;AAKD;;IAaKE,iB;;;;;AAEJ,6BAAYF,KAAZ,EAA8B;AAAA;;AAAA;;AAC5B,2FAAMA,KAAN;AAEA,UAAKG,KAAL,GAAa;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXC,MAAAA,MAAM,EAAE;AAFG,KAAb;AAH4B;AAO7B;AAED;;;;;;;;wCAIoB;AAAA,wBACS,KAAKF,KADd;AAAA,UACVC,MADU,eACVA,MADU;AAAA,UACFC,MADE,eACFA,MADE;AAAA,UAEVC,eAFU,GAEU,KAAKN,KAFf,CAEVM,eAFU;AAGlB,UAAMC,SAAS,GAAG,8BAAlB;;AACA,UAAKD,eAAe,IAAIA,eAAe,CAACF,MAAhB,KAA2BI,SAA9C,IAA2DF,eAAe,CAACF,MAAhB,KAA2BA,MAAvF,IAAkGG,SAAS,KAAKH,MAApH,EAA6H;AAC3H,aAAKK,QAAL,CAAc;AACZL,UAAAA,MAAM,EAAEE,eAAe,IAAIA,eAAe,CAACF,MAAhB,KAA2BI,SAA9C,GAA0DF,eAAe,CAACF,MAA1E,GAAmFG,SAD/E;AAEZF,UAAAA,MAAM,EAAEC,eAAe,IAAIA,eAAe,CAACD,MAAhB,KAA2BG,SAA9C,GAA0DF,eAAe,CAACD,MAA1E,GAAoF,8BAAmB,wBAAnB,GAAmCA;AAFnH,SAAd;AAID;AACF;;;6BAEQ;AAAA,yBACoB,KAAKF,KADzB;AAAA,UACCC,MADD,gBACCA,MADD;AAAA,UACSC,MADT,gBACSA,MADT;AAAA,wBAEkE,KAAKL,KAFvE;AAAA,UAEYD,gBAFZ,eAECW,SAFD;AAAA,UAE8BC,cAF9B,eAE8BA,cAF9B;AAAA,UAE8CL,eAF9C,eAE8CA,eAF9C;AAGP,aACE,oBAAC,WAAD,CAAa,QAAb;AAAsB,QAAA,KAAK,EAAE;AAAEF,UAAAA,MAAM,EAANA,MAAF;AAAUC,UAAAA,MAAM,EAANA;AAAV;AAA7B,SACI,oBAAC,WAAD,CAAa,QAAb,QACG,UAACJ,KAAD;AAAA,eAA6B,oBAAC,gBAAD,eAAsBU,cAAtB;AAA6C,UAAA,WAAW,EAAEV;AAA1D,WAA7B;AAAA,OADH,CADJ,CADF;AAOD;;;;EArC6BL,KAAK,CAACgB,S;;gBAAhCV,iB;AAVJQ,EAAAA,S;AACAC,EAAAA,c;AACAL,EAAAA,e;AAjBAF,IAAAA,M;AACAC,IAAAA,M","sourcesContent":["import * as React from 'react';\nimport { isOUIAEnvironment, getUniqueId, generateOUIAId } from './ouia';\nimport { Omit } from '../../helpers/typeUtils';\n\nexport const OuiaContext = React.createContext<OuiaContextProps | null>(null);\n\nexport interface InjectedOuiaProps {\n  ouiaContext?: OuiaContextProps;\n  ouiaId?: number | string;\n}\n\nexport interface OuiaContextProps {\n  isOuia?: boolean;\n  ouiaId?: number | string;\n}\n\nexport function withOuiaContext<P extends { ouiaContext?: OuiaContextProps }, R = Omit<P, 'ouiaContext'>>(\n  WrappedComponent: React.ComponentClass<P> | React.FunctionComponent<P>\n): React.FunctionComponent<R> {\n  return (props: R) => (\n    <OuiaContext.Consumer>\n      {(value: OuiaContextProps) => <ComponentWithOuia consumerContext={value} component={WrappedComponent} componentProps={props} />}\n    </OuiaContext.Consumer>\n  );\n}\n\ninterface OuiaProps {\n  component: any;\n  componentProps: any;\n  consumerContext?: OuiaContextProps;\n}\n\ninterface OuiaState {\n  isOuia?: boolean;\n  ouiaId?: number | string;\n}\n\nclass ComponentWithOuia extends React.Component<OuiaProps, OuiaState> {\n\n  constructor(props: OuiaProps) {\n    super(props);\n\n    this.state = {\n      isOuia: false,\n      ouiaId: null\n    };\n  }\n\n  /**\n   * if either consumer set isOuia through context or local storage\n   * then force a re-render\n   */\n  componentDidMount() {\n    const { isOuia, ouiaId } = this.state;\n    const { consumerContext } = this.props;\n    const isOuiaEnv = isOUIAEnvironment();\n    if ((consumerContext && consumerContext.isOuia !== undefined && consumerContext.isOuia !== isOuia) || isOuiaEnv !== isOuia ) {\n      this.setState({\n        isOuia: consumerContext && consumerContext.isOuia !== undefined ? consumerContext.isOuia : isOuiaEnv,\n        ouiaId: consumerContext && consumerContext.ouiaId !== undefined ? consumerContext.ouiaId : (generateOUIAId() ? getUniqueId() : ouiaId)\n      });\n    }\n  }\n\n  render() {\n    const { isOuia, ouiaId } = this.state;\n    const { component: WrappedComponent, componentProps, consumerContext } = this.props;\n    return (\n      <OuiaContext.Provider value={{ isOuia, ouiaId }}>\n          <OuiaContext.Consumer>\n            {(value: OuiaContextProps) => <WrappedComponent {...componentProps as any} ouiaContext={value} />}\n          </OuiaContext.Consumer>\n      </OuiaContext.Provider>\n    );\n  }\n}\n"],"file":"withOuia.js"}