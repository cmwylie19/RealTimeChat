{"version":3,"sources":["../../../../esm/build/jest/snapshot-serializer/cssUtils.js"],"names":["css","jsdom","JSDOM","getSelectors","nodes","reduce","selectors","node","props","getSelectorsFromProps","className","class","toString","split","map","cn","componentToHex","c","hex","length","rgbToHex","r","g","b","getComputedStyles","classNames","cssStr","dom","cs","window","getComputedStyle","document","body","children","values","i","key","value","getPropertyValue","replace","full","match","n","parseInt","getStylesAST","bufferedStyles","globalCSS","ast","parse","vars","getVarValue","stylesheet","rules","rule","type","declarations","decl","property","startsWith","formatComputedStyles","nodeSelectors","computedStyles","selector","join","cssString","Object","keys","k","stringify","getStyles","insertedStyles","acc","sel","re","RegExp","test","s"],"mappings":"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","sourcesContent":["import * as css from 'css';\nimport * as jsdom from 'jsdom';\nconst {\n  JSDOM\n} = jsdom;\n\nfunction getSelectors(nodes) {\n  return nodes.reduce((selectors, node) => {\n    const props = typeof node.props === 'function' ? node.props() : node.props;\n    return [...selectors, getSelectorsFromProps(props)];\n  }, []);\n}\n\nfunction getSelectorsFromProps(props = {}) {\n  const className = props.className || props.class;\n\n  if (className) {\n    return className.toString().split(' ').map(cn => `.${cn}`);\n  }\n\n  return [];\n}\n\nfunction componentToHex(c) {\n  const hex = c.toString(16);\n  return hex.length === 1 ? `0${hex}` : hex;\n}\n\nfunction rgbToHex(r, g, b) {\n  return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}`;\n}\n\nfunction getComputedStyles(classNames, cssStr) {\n  const dom = new JSDOM(`<!DOCTYPE html>\n      <head><style>${cssStr}</style></head>\n      <body><div class=\"${classNames}\"></div>\n      </body>`);\n  const cs = dom.window.getComputedStyle(dom.window.document.body.children[0]);\n  const values = {};\n\n  for (let i = 0; i < cs.length; i++) {\n    const key = cs[i];\n    const value = cs.getPropertyValue(key).replace(/rgb\\(([\\d|,|\\s]+)\\)/g, (full, match) => rgbToHex(...match.split(',').map(n => parseInt(n, 10))));\n    values[key] = value;\n  }\n\n  return values;\n}\n\nfunction getStylesAST(bufferedStyles, globalCSS = '') {\n  const ast = css.parse(`${globalCSS}\\n${bufferedStyles}`);\n  const vars = {};\n\n  const getVarValue = value => value.replace(/var\\(([\\w|-]*)\\)/g, (full, match) => vars[match]);\n\n  ast.stylesheet.rules = ast.stylesheet.rules.map(rule => {\n    if (rule.type === 'rule') {\n      rule.declarations = rule.declarations.map(decl => {\n        if (decl.type === 'declaration') {\n          const {\n            property,\n            value\n          } = decl;\n\n          if (property.startsWith('--')) {\n            vars[property] = getVarValue(value);\n          }\n\n          decl.value = getVarValue(value);\n        }\n\n        return decl;\n      });\n    }\n\n    return rule;\n  });\n  return ast;\n}\n\nfunction formatComputedStyles(nodeSelectors, computedStyles) {\n  const selector = nodeSelectors.join('');\n  const cssString = `${selector} {\n    ${Object.keys(computedStyles).map(k => `${k}: ${computedStyles[k]};`).join('\\n')}\n  }`;\n  return css.stringify(css.parse(cssString));\n}\n\nfunction getStyles(nodeSelectors, insertedStyles, globalCSS) {\n  if (!nodeSelectors.length) {\n    return '';\n  }\n\n  const ast = getStylesAST(insertedStyles, globalCSS);\n  return nodeSelectors.reduce((acc, sel) => {\n    if (!sel.length) {\n      return acc;\n    }\n\n    const re = new RegExp(`(${sel.join('|')})`, 'g');\n\n    if (!re.test(insertedStyles)) {\n      return acc;\n    }\n\n    const computedStyles = getComputedStyles(sel.map(s => s.replace('.', '')).join(' '), css.stringify(ast));\n    return [...acc, formatComputedStyles(sel, computedStyles)];\n  }, []).join('\\n');\n}\n\nexport { getSelectors, getStyles };\n//# sourceMappingURL=cssUtils.js.map"],"file":"cssUtils.js"}