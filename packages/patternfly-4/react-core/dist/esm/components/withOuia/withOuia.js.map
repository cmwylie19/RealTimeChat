{"version":3,"sources":["../../../../src/components/withOuia/withOuia.tsx"],"names":["React","isOUIAEnvironment","getUniqueId","generateOUIAId","OuiaContext","createContext","withOuiaContext","WrappedComponent","props","value","ComponentWithOuia","Component","constructor","state","isOuia","ouiaId","componentDidMount","consumerContext","isOuiaEnv","undefined","setState","render","component","componentProps"],"mappings":";;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,SAASC,iBAAT,EAA4BC,WAA5B,EAAyCC,cAAzC,QAA+D,QAA/D;AAGA,OAAO,MAAMC,WAAW,GAAGJ,KAAK,CAACK,aAAN,CAA6C,IAA7C,CAApB;AAYP,OAAO,SAASC,eAAT,CACLC,gBADK,EAEuB;AAC5B,SAAQC,KAAD,IACL,oBAAC,WAAD,CAAa,QAAb,QACIC,KAAD,IAA6B,oBAAC,iBAAD;AAAmB,IAAA,eAAe,EAAEA,KAApC;AAA2C,IAAA,SAAS,EAAEF,gBAAtD;AAAwE,IAAA,cAAc,EAAEC;AAAxF,IADhC,CADF;AAKD;;AAaD,MAAME,iBAAN,SAAgCV,KAAK,CAACW,SAAtC,CAAsE;AAEpEC,EAAAA,WAAW,CAACJ,KAAD,EAAmB;AAC5B,UAAMA,KAAN;AAEA,SAAKK,KAAL,GAAa;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXC,MAAAA,MAAM,EAAE;AAFG,KAAb;AAID;AAED;;;;;;AAIAC,EAAAA,iBAAiB,GAAG;AAClB,UAAM;AAAEF,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAqB,KAAKF,KAAhC;AACA,UAAM;AAAEI,MAAAA;AAAF,QAAsB,KAAKT,KAAjC;AACA,UAAMU,SAAS,GAAGjB,iBAAiB,EAAnC;;AACA,QAAKgB,eAAe,IAAIA,eAAe,CAACH,MAAhB,KAA2BK,SAA9C,IAA2DF,eAAe,CAACH,MAAhB,KAA2BA,MAAvF,IAAkGI,SAAS,KAAKJ,MAApH,EAA6H;AAC3H,WAAKM,QAAL,CAAc;AACZN,QAAAA,MAAM,EAAEG,eAAe,IAAIA,eAAe,CAACH,MAAhB,KAA2BK,SAA9C,GAA0DF,eAAe,CAACH,MAA1E,GAAmFI,SAD/E;AAEZH,QAAAA,MAAM,EAAEE,eAAe,IAAIA,eAAe,CAACF,MAAhB,KAA2BI,SAA9C,GAA0DF,eAAe,CAACF,MAA1E,GAAoFZ,cAAc,KAAKD,WAAW,EAAhB,GAAqBa;AAFnH,OAAd;AAID;AACF;;AAEDM,EAAAA,MAAM,GAAG;AACP,UAAM;AAAEP,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAqB,KAAKF,KAAhC;AACA,UAAM;AAAES,MAAAA,SAAS,EAAEf,gBAAb;AAA+BgB,MAAAA,cAA/B;AAA+CN,MAAAA;AAA/C,QAAmE,KAAKT,KAA9E;AACA,WACE,oBAAC,WAAD,CAAa,QAAb;AAAsB,MAAA,KAAK,EAAE;AAAEM,QAAAA,MAAF;AAAUC,QAAAA;AAAV;AAA7B,OACI,oBAAC,WAAD,CAAa,QAAb,QACIN,KAAD,IAA6B,oBAAC,gBAAD,eAAsBc,cAAtB;AAA6C,MAAA,WAAW,EAAEd;AAA1D,OADhC,CADJ,CADF;AAOD;;AArCmE;;gBAAhEC,iB;AAVJY,EAAAA,S;AACAC,EAAAA,c;AACAN,EAAAA,e;AAjBAH,IAAAA,M;AACAC,IAAAA,M","sourcesContent":["import * as React from 'react';\nimport { isOUIAEnvironment, getUniqueId, generateOUIAId } from './ouia';\nimport { Omit } from '../../helpers/typeUtils';\n\nexport const OuiaContext = React.createContext<OuiaContextProps | null>(null);\n\nexport interface InjectedOuiaProps {\n  ouiaContext?: OuiaContextProps;\n  ouiaId?: number | string;\n}\n\nexport interface OuiaContextProps {\n  isOuia?: boolean;\n  ouiaId?: number | string;\n}\n\nexport function withOuiaContext<P extends { ouiaContext?: OuiaContextProps }, R = Omit<P, 'ouiaContext'>>(\n  WrappedComponent: React.ComponentClass<P> | React.FunctionComponent<P>\n): React.FunctionComponent<R> {\n  return (props: R) => (\n    <OuiaContext.Consumer>\n      {(value: OuiaContextProps) => <ComponentWithOuia consumerContext={value} component={WrappedComponent} componentProps={props} />}\n    </OuiaContext.Consumer>\n  );\n}\n\ninterface OuiaProps {\n  component: any;\n  componentProps: any;\n  consumerContext?: OuiaContextProps;\n}\n\ninterface OuiaState {\n  isOuia?: boolean;\n  ouiaId?: number | string;\n}\n\nclass ComponentWithOuia extends React.Component<OuiaProps, OuiaState> {\n\n  constructor(props: OuiaProps) {\n    super(props);\n\n    this.state = {\n      isOuia: false,\n      ouiaId: null\n    };\n  }\n\n  /**\n   * if either consumer set isOuia through context or local storage\n   * then force a re-render\n   */\n  componentDidMount() {\n    const { isOuia, ouiaId } = this.state;\n    const { consumerContext } = this.props;\n    const isOuiaEnv = isOUIAEnvironment();\n    if ((consumerContext && consumerContext.isOuia !== undefined && consumerContext.isOuia !== isOuia) || isOuiaEnv !== isOuia ) {\n      this.setState({\n        isOuia: consumerContext && consumerContext.isOuia !== undefined ? consumerContext.isOuia : isOuiaEnv,\n        ouiaId: consumerContext && consumerContext.ouiaId !== undefined ? consumerContext.ouiaId : (generateOUIAId() ? getUniqueId() : ouiaId)\n      });\n    }\n  }\n\n  render() {\n    const { isOuia, ouiaId } = this.state;\n    const { component: WrappedComponent, componentProps, consumerContext } = this.props;\n    return (\n      <OuiaContext.Provider value={{ isOuia, ouiaId }}>\n          <OuiaContext.Consumer>\n            {(value: OuiaContextProps) => <WrappedComponent {...componentProps as any} ouiaContext={value} />}\n          </OuiaContext.Consumer>\n      </OuiaContext.Provider>\n    );\n  }\n}\n"],"file":"withOuia.js"}